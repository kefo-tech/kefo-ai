<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…Ù†ØµØ© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ - ÙˆØ§Ø¬Ù‡Ø© Ø¯Ø±Ø¯Ø´Ø© ØªÙ‚Ù†ÙŠØ©</title>

  <!--
    [Ù‚Ø³Ù… Ø§Ù„Ø®Ø·ÙˆØ·]
    - ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ù†Ø³ØªØ®Ø¯Ù… Ø®Ø· Terminal/Monospace Ù„Ø¥Ø­Ø³Ø§Ø³ "Ø§Ù„Ù…Ø§ØªØ±ÙŠÙƒØ³".
    - ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ Ù†Ø³ØªØ®Ø¯Ù… Cairo/Inter Ù„Ù‚Ø±Ø§Ø¡Ø© Ø£ÙˆØ¶Ø­.
  -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* =========================
       [1] Reset + Variables
       ========================= */

    *, *::before, *::after { box-sizing: border-box; }

    /*
      Ø£Ù‡Ù… Ù†Ù‚Ø·Ø© Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© "Ø§Ù„Ù†Ø§ÙØ°Ø© ØªØªØ¬Ù‡ Ù„Ù„Ø£Ø³ÙÙ„":
      - Ù†Ø¬Ø¹Ù„ Ø§Ù„ØµÙØ­Ø© Ù†ÙØ³Ù‡Ø§ ØºÙŠØ± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± (overflow: hidden)
      - Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙŠÙƒÙˆÙ† ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© #conversation
      Ù‡Ø°Ø§ ÙŠÙ…Ù†Ø¹ Ø£ÙŠ Ù†Ø²ÙˆÙ„ Ù„Ù„ØµÙØ­Ø© Ø£Ùˆ Ø¯ÙØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„Ù„Ø£Ø³ÙÙ„.
    */
    html, body {
      height: 100%;
      overflow: hidden; /* ÙŠÙ…Ù†Ø¹ ØªØ­Ø±Ù‘Ùƒ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ø£Ø³ÙÙ„ */
    }

    /* Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø®Ø·ÙˆØ· Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
    :root{
      --bg: #000;
      --text: #0f0;
      --panel: rgba(0,0,0,0.85);
      --panel2: rgba(0,0,0,0.92);
      --border: #0f0;
      --bubble: rgba(0,128,0,0.2);
      --bubble-user: rgba(0,255,0,0.3);
      --shadow: 0 0 20px var(--border);
      --muted: rgba(0,255,0,0.75);
      --btn-bg: #000;
      --btn-text: #0f0;
      --btn-hover-bg: #0f0;
      --btn-hover-text: #000;
      --font: "Courier New", Courier, monospace;
    }

    /*
      [2] Theme: Light
      - Ø®Ø· ÙˆØ§Ø¶Ø­ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©: Cairo/Inter
      - ØªØ¨Ø§ÙŠÙ† Ø£Ø¹Ù„Ù‰
      - Ø£Ù„ÙˆØ§Ù† Ù‡Ø§Ø¯Ø¦Ø©
    */
    body.theme-light{
      --bg: #f7f9ff;
      --text: #102a10;
      --panel: rgba(255,255,255,0.92);
      --panel2: rgba(255,255,255,0.97);
      --border: #153a15;
      --bubble: rgba(21,58,21,0.08);
      --bubble-user: rgba(21,58,21,0.12);
      --shadow: 0 10px 26px rgba(0,0,0,0.12);
      --muted: rgba(16,42,16,0.7);
      --btn-bg: #ffffff;
      --btn-text: #153a15;
      --btn-hover-bg: #153a15;
      --btn-hover-text: #ffffff;
      --font: "Cairo", "Inter", system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
    }

    /* =========================
       [3] Layout: App Shell
       ========================= */

    body {
      font-family: var(--font);
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 0;
      user-select: none;
      display: flex;
      justify-content: center;
    }

    /*
      .app:
      - Ø¹Ù…ÙˆØ¯ ÙƒØ§Ù…Ù„ Ø§Ù„ØµÙØ­Ø©
      - padding-bottom Ù„ØªØ±Ùƒ Ù…Ø³Ø§Ø­Ø© Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø«Ø§Ø¨Øª (fixed)
    */
    .app {
      width: 100%;
      max-width: 720px;
      display: flex;
      flex-direction: column;
      height: 100vh;        /* Ù…Ù‡Ù…: ÙŠØ³Ø§ÙˆÙŠ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© */
      padding: 10px;
      padding-bottom: 96px; /* Ù…Ø³Ø§Ø­Ø© Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
      gap: 10px;
    }

    /* =========================
       [4] Header (Sticky Top)
       ========================= */

    .header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: var(--panel2);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 10px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .header h1{
      margin: 0;
      font-size: 1.2rem;
      text-shadow: 0 0 10px var(--border), 0 0 20px var(--border);
      line-height: 1.2;
    }

    .icon-btn{
      background: var(--btn-bg);
      color: var(--btn-text);
      border: 1px solid var(--border);
      width: 40px;
      height: 40px;
      border-radius: 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 10px rgba(0,255,0,0.15);
      transition: transform 0.12s ease, background 0.12s ease, color 0.12s ease;
      font-size: 18px;
    }

    .icon-btn:hover{
      background: var(--btn-hover-bg);
      color: var(--btn-hover-text);
      transform: scale(1.05);
    }

    /* =========================
       [5] Chat Container
       ========================= */

    /*
      #chat-container:
      - ÙŠØ£Ø®Ø° ÙƒÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
      - min-height:0 Ù…Ù‡Ù… Ø­ØªÙ‰ ÙŠØ¹Ù…Ù„ overflow ÙÙŠ Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
    */
    #chat-container {
      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: 12px;
      box-shadow: var(--shadow);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
    }

    /*
      #conversation:
      - Ù‡Ø°Ù‡ Ù‡ÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ÙˆØ­ÙŠØ¯Ø©
      - overscroll-behavior ÙŠÙ…Ù†Ø¹ Ø³Ø­Ø¨ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ù€ body
      - padding-bottom Ø¨Ø³ÙŠØ·
    */
    #conversation {
      padding: 12px;
      background: var(--panel2);
      overflow-y: auto;
      flex: 1;
      min-height: 0;
      scroll-behavior: auto;      /* Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù†ÙØ¶Ù‘Ù„ auto Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² */
      overscroll-behavior: contain;
      direction: rtl;
    }

    /* ÙÙ‚Ø§Ø¹Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
    .message-bubble {
      background: var(--bubble);
      color: var(--text);
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      margin: 10px 0;
      max-width: 92%;
      word-wrap: break-word;
      line-height: 1.7;
    }

    .user-bubble {
      margin-right: auto;
      background: var(--bubble-user);
    }

    /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù‚Ø§Ù„ (Ø§Ù„Ù†ØªÙŠØ¬Ø©) */
    .article-container {
      padding: 14px;
      background: rgba(0, 128, 0, 0.08);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin: 12px 0;
    }
    body.theme-light .article-container{ background: rgba(21,58,21,0.06); }

    .typing-effect {
      white-space: pre-wrap;
    }

    .signature {
      margin-top: 8px;
      font-size: 14px;
      color: var(--muted);
      text-align: left;
      font-style: italic;
    }

    .copy-btn {
      background: var(--btn-bg);
      color: var(--btn-text);
      border: 1px solid var(--border);
      padding: 9px 14px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 10px;
      margin-top: 12px;
      display: inline-block;
      transition: transform 0.12s ease, background 0.12s ease, color 0.12s ease;
    }
    .copy-btn:hover {
      background: var(--btn-hover-bg);
      color: var(--btn-hover-text);
      transform: scale(1.03);
    }

    /* =========================
       [6] Input Bar (Fixed Bottom)
       ========================= */

    /*
      Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø«Ø§Ø¨Øª ØªÙ…Ø§Ù…Ø§Ù‹ ÙˆÙ„Ù† ÙŠØªØ­Ø±Ùƒ:
      position: fixed
      ÙˆÙ‡Ø°Ø§ ÙŠÙ…Ù†Ø¹ Ø£ÙŠ ØªØ­Ø±Ùƒ Ø£Ø«Ù†Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬.
    */
    #input-container {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 10px;
      width: calc(100% - 20px);
      max-width: 720px;
      z-index: 60;

      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: var(--panel2);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: var(--shadow);
    }

    #userInput {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--btn-bg);
      color: var(--btn-text);
      caret-color: var(--border);
      outline: none;
    }

    #sendBtn {
      background: var(--btn-bg);
      color: var(--btn-text);
      border: 1px solid var(--border);
      padding: 12px 18px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 10px;
      white-space: nowrap;
      transition: transform 0.12s ease, background 0.12s ease, color 0.12s ease;
    }
    #sendBtn:hover {
      background: var(--btn-hover-bg);
      color: var(--btn-hover-text);
      transform: scale(1.03);
    }

    /* =========================
       [7] Notifications
       ========================= */

    .notification {
      position: fixed;
      bottom: 110px;
      right: 20px;
      background: var(--border);
      color: var(--btn-hover-text);
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: bold;
      box-shadow: var(--shadow);
      z-index: 200;
      transition: opacity 0.5s ease-in-out;
      max-width: calc(100% - 40px);
    }

    /* =========================
       [8] Settings Drawer
       ========================= */

    .settings-drawer{
      position: fixed;
      inset: 0;
      z-index: 100;
      display: none;
    }
    .settings-drawer.open{ display: block; }

    .settings-backdrop{
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.55);
    }

    .settings-panel{
      position: absolute;
      top: 12px;
      left: 12px;
      right: 12px;
      max-width: 720px;
      margin: 0 auto;
      background: var(--panel2);
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 12px;
    }

    .settings-panel h2{
      margin: 0 0 10px 0;
      font-size: 1.05rem;
    }

    .setting-row{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px;
      border: 1px dashed var(--border);
      border-radius: 12px;
      background: var(--panel);
      margin-bottom: 10px;
    }

    .toggle{
      display: inline-flex;
      gap: 10px;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }
    .toggle input{ display:none; }

    .toggle-pill{
      width: 54px;
      height: 30px;
      border-radius: 99px;
      border: 1px solid var(--border);
      background: var(--btn-bg);
      position: relative;
    }
    .toggle-pill::after{
      content: "";
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--border);
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      right: 3px;
      transition: right 0.2s ease;
    }
    .toggle input:checked + .toggle-pill::after{ right: 27px; }

    .btn{
      background: var(--btn-bg);
      color: var(--btn-text);
      border: 1px solid var(--border);
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.12s ease, background 0.12s ease, color 0.12s ease;
      font-size: 14px;
    }
    .btn:hover{
      background: var(--btn-hover-bg);
      color: var(--btn-hover-text);
      transform: scale(1.03);
    }

    .settings-footer{
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding-top: 6px;
    }

    /* =========================
       [9] Language Modal (First Run)
       ========================= */

    .lang-modal{
      position: fixed;
      inset: 0;
      z-index: 300;
      display: none;
      background: rgba(0,0,0,0.7);
    }
    .lang-modal.open{ display: grid; place-items: center; }

    .lang-card{
      width: calc(100% - 24px);
      max-width: 520px;
      background: var(--panel2);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 14px;
    }

    .lang-card h3{
      margin: 0 0 10px 0;
      font-size: 1.05rem;
      line-height: 1.5;
    }

    .lang-grid{
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 10px;
    }

    .lang-btn{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--panel);
      cursor: pointer;
      transition: transform 0.12s ease, background 0.12s ease;
    }
    .lang-btn:hover{
      transform: scale(1.01);
      background: rgba(0,255,0,0.08);
    }
    body.theme-light .lang-btn:hover{
      background: rgba(21,58,21,0.08);
    }

    .lang-left{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .flag{
      font-size: 20px;
      line-height: 1;
      
    }

    .lang-name{ font-weight: 700;color: rgba(0,255,0,0.7); }
    .lang-code{ font-size: 12px; opacity: 0.8; }

    /* =========================
       [10] Responsive
       ========================= */

    @media (max-width: 600px) {
      .app{ padding: 8px; padding-bottom: 100px; }
      .header h1 { font-size: 1.05rem; }
      #sendBtn { padding: 12px 14px; font-size: 15px; }
      .message-bubble { max-width: 100%; font-size: 14px; }
      #input-container { bottom: 8px; width: calc(100% - 16px); }
    }
  </style>
</head>

<body>
  <!-- =========================
       [A] App Layout
       - Header + Chat container
       ========================= -->
  <div class="app">
    <div class="header">
      <h1 id="appTitle">Ù…Ù†ØµØ© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ</h1>
      <button class="icon-btn" id="settingsBtn" title="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" aria-label="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">âš™ï¸</button>
    </div>

    <!-- Ù…ÙˆØ³ÙŠÙ‚Ù‰ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©) -->
    <audio id="background-music" preload="none" controls style="display:none">
      <source src="https://assets.mixkit.co/active_storage/sfx/2467/2467-preview.mp3" type="audio/mpeg" />
    </audio>

    <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
    <div id="chat-container">
      <div id="conversation">
        <!--
          [Ù…Ø±Ø³Ø§Ø© Ø£Ø³ÙÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©]
          Ù‡Ø°Ù‡ Ø£Ù‡Ù… Ù†Ù‚Ø·Ø© Ù„ØªØªØ¨Ù‘Ø¹ Ø¢Ø®Ø± Ø³Ø·Ø±:
          Ø³Ù†Ø³ØªØ¯Ø¹ÙŠ scrollIntoView Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ± Ù…Ø¹ ÙƒÙ„ Ø­Ø±Ù.
        -->
        <div id="bottomAnchor" style="height:1px;"></div>
      </div>
    </div>
  </div>

  <!-- =========================
       [B] Input Bar (Fixed)
       - Ø«Ø§Ø¨Øª Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹
       ========================= -->
  <div id="input-container">
    <input type="text" id="userInput" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø£Ùˆ Ø¬Ù…Ù„Ø© Ù„Ù„Ø¨Ø­Ø«" />
    <button id="sendBtn">Ø¨Ø­Ø«</button>
  </div>

  <!-- =========================
       [C] Settings Drawer
       - ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ/Ù†Ù‡Ø§Ø±ÙŠ + Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
       ========================= -->
  <div class="settings-drawer" id="settingsDrawer" aria-hidden="true">
    <div class="settings-backdrop" id="settingsBackdrop"></div>
    <div class="settings-panel" role="dialog" aria-modal="true" aria-label="Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">
      <h2 id="settingsTitle">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>

      <div class="setting-row">
        <div id="themeRowLabel">Ø§Ù„ÙˆØ¶Ø¹</div>
        <label class="toggle" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ/Ù†Ù‡Ø§Ø±ÙŠ">
          <input type="checkbox" id="themeToggle" />
          <span class="toggle-pill"></span>
          <span id="themeLabel">Ù„ÙŠÙ„ÙŠ</span>
        </label>
      </div>

      <div class="setting-row">
        <div id="langRowLabel">Ø§Ù„Ù„ØºØ©</div>
        <div style="display:flex; gap:10px; align-items:center;">
          <span id="currentLangLabel" style="opacity:.9;"></span>
          <button class="btn" id="changeLangBtn">ØªØºÙŠÙŠØ±</button>
        </div>
      </div>

      <div class="settings-footer">
        <button class="btn" id="closeSettingsBtn">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>

  <!-- =========================
       [D] Language Modal (First Run)
       - ÙŠØ¸Ù‡Ø± Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ÙØªØ­
       - ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ÙÙŠ localStorage
       ========================= -->
  <div class="lang-modal" id="langModal">
    <div class="lang-card">
      <h3 id="langPrompt">Ø§Ø®ØªØ± Ù„ØºØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>

      <div class="lang-grid">
        <button class="lang-btn" data-lang="ar">
          <div class="lang-left">
            <span class="flag">ğŸ‡µğŸ‡¸</span>
            <div>
              <div class="lang-name">Ø¹Ø±Ø¨ÙŠ</div>
              <div class="lang-code">Wikipedia: ar</div>
            </div>
          </div>
          <span>â†’</span>
        </button>

        <button class="lang-btn" data-lang="en">
          <div class="lang-left">
            <span class="flag">ğŸ‡¬ğŸ‡§</span>
            <div>
              <div class="lang-name">English</div>
              <div class="lang-code">Wikipedia: en</div>
            </div>
          </div>
          <span>â†’</span>
        </button>

        <button class="lang-btn" data-lang="de">
          <div class="lang-left">
            <span class="flag">ğŸ‡©ğŸ‡ª</span>
            <div>
              <div class="lang-name">Deutsch</div>
              <div class="lang-code">Wikipedia: de</div>
            </div>
          </div>
          <span>â†’</span>
        </button>
      </div>

      <div style="margin-top:12px; font-size:12px; opacity:.85;" id="langHint">
        Ø³ÙŠØªÙ… ØªØ°ÙƒØ± Ø§Ø®ØªÙŠØ§Ø±Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
      </div>
    </div>
  </div>

  <script>
    /* =========================
       [1] DOM References + Storage Keys
       ========================= */

    const conversationContainer = document.getElementById('conversation');
    const bottomAnchor = document.getElementById('bottomAnchor');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');

    const settingsBtn = document.getElementById('settingsBtn');
    const settingsDrawer = document.getElementById('settingsDrawer');
    const settingsBackdrop = document.getElementById('settingsBackdrop');
    const closeSettingsBtn = document.getElementById('closeSettingsBtn');

    const themeToggle = document.getElementById('themeToggle');
    const themeLabel = document.getElementById('themeLabel');

    const langModal = document.getElementById('langModal');
    const langPrompt = document.getElementById('langPrompt');
    const changeLangBtn = document.getElementById('changeLangBtn');
    const currentLangLabel = document.getElementById('currentLangLabel');

    const STORAGE_THEME = 'kefotube_science_theme';
    const STORAGE_LANG  = 'kefotube_science_lang';

    let isMusicPlayed = false;

    /*
      wikiLang:
      - Ù„ØºØ© ÙˆÙŠÙƒÙŠØ¨ÙŠØ¯ÙŠØ§ Ø§Ù„ØªÙŠ Ø³Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·:
      - ar / en / de
    */
    let wikiLang = 'ar';

    /* =========================
       [2] Ø£Ù‡Ù… Ø¯Ø§Ù„Ø©: keepLastLineVisible()
       =========================
       Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ØªÙØ¨Ù‚ÙŠ Ø¢Ø®Ø± Ø³Ø·Ø±/Ø­Ø±Ù Ø¸Ø§Ù‡Ø± Ø¯Ø§Ø¦Ù…Ø§Ù‹:
       - ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ bottomAnchor Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
       - ØªØ³ØªØ®Ø¯Ù… scrollIntoView Ù„ÙŠØ¶Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ Ø¥Ø¨Ø±Ø§Ø² Ø¢Ø®Ø± Ù†Ù‚Ø·Ø©.
    */
    function keepLastLineVisible() {
      bottomAnchor.scrollIntoView({ behavior: 'auto', block: 'end' });
    }

    /* =========================
       [3] Theme Functions
       ========================= */

    function applyTheme(theme) {
      const isLight = theme === 'light';
      document.body.classList.toggle('theme-light', isLight);
      themeToggle.checked = isLight;
      themeLabel.textContent = isLight ? 'Ù†Ù‡Ø§Ø±ÙŠ' : 'Ù„ÙŠÙ„ÙŠ';
      localStorage.setItem(STORAGE_THEME, theme);
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
    (function initTheme(){
      const saved = localStorage.getItem(STORAGE_THEME) || 'dark';
      applyTheme(saved);
    })();

    themeToggle.addEventListener('change', () => {
      applyTheme(themeToggle.checked ? 'light' : 'dark');
    });

    /* =========================
       [4] Settings Drawer (Open/Close)
       ========================= */

    function openSettings(){
      settingsDrawer.classList.add('open');
      settingsDrawer.setAttribute('aria-hidden', 'false');
    }

    function closeSettings(){
      settingsDrawer.classList.remove('open');
      settingsDrawer.setAttribute('aria-hidden', 'true');
    }

    settingsBtn.addEventListener('click', openSettings);
    closeSettingsBtn.addEventListener('click', closeSettings);
    settingsBackdrop.addEventListener('click', closeSettings);

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeSettings();
        closeLangModal();
      }
    });

    /* =========================
       [5] UI Language (Prompt Text) Based on Device Language
       ========================= */

    function getDeviceUILang(){
      const l = (navigator.language || 'en').toLowerCase();
      if (l.startsWith('ar')) return 'ar';
      if (l.startsWith('de')) return 'de';
      return 'en';
    }

    const uiLang = getDeviceUILang();

    const uiText = {
      ar: {
        langPrompt: "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø§Ø®ØªØ± Ù„ØºØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬",
        langHint: "Ø³ÙŠØªÙ… ØªØ°ÙƒØ± Ø§Ø®ØªÙŠØ§Ø±Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",
        welcomeMsg: "Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø£Ùˆ Ù…ØµØ·Ù„Ø­Ø§Ù‹ØŒ ÙˆØ³Ø£Ø¹Ø±Ø¶ Ù„Ùƒ Ù†ØªØ§Ø¦Ø¬ ÙˆÙŠÙƒÙŠØ¨ÙŠØ¯ÙŠØ§ Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©.",
        inputPlaceholder: "Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø£Ùˆ Ø¬Ù…Ù„Ø© Ù„Ù„Ø¨Ø­Ø«",
        searchBtn: "Ø¨Ø­Ø«",
        noTerm: "â— ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø«",
        searching: "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...",
        results: "ğŸ“„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« (Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±Ø­):",
        fetching: "ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø´Ø±Ø­...",
        noResults: (t)=>`Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„ÙƒÙ„Ù…Ø©: "${t}"`,
        searchErr: "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¨Ø­Ø«ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§.",
        fetchErr: "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø´Ø±Ø­ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§.",
        copyBtn: "Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©",
        copied: "âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ!",
        copyFail: "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ù†Ø³Ø®!",
        signature: "Ø¨Ù‚Ù„Ù… Ø²ÙƒØ±ÙŠØ§ ÙƒÙŠÙÙˆ",
        currentLang: (code)=>({ar:"Ø¹Ø±Ø¨ÙŠ",en:"English",de:"Deutsch"}[code]||code)
      },
      en: {
        langPrompt: "Welcome, choose results language",
        langHint: "Your choice will be remembered next time.",
        welcomeMsg: "Type a term and I will show Wikipedia results in your selected language.",
        inputPlaceholder: "Type a word or phrase to search",
        searchBtn: "Search",
        noTerm: "â— Please type a search term",
        searching: "Searching...",
        results: "ğŸ“„ Results (click a title to view the summary):",
        fetching: "ğŸ”„ Fetching summary...",
        noResults: (t)=>`No results for: "${t}"`,
        searchErr: "âŒ Search error. Please try again later.",
        fetchErr: "âŒ Error fetching summary. Please try again later.",
        copyBtn: "Copy result",
        copied: "âœ… Copied!",
        copyFail: "âŒ Copy failed!",
        signature: "By Zakaria KeFo",
        currentLang: (code)=>({ar:"Arabic",en:"English",de:"German"}[code]||code)
      },
      de: {
        langPrompt: "Willkommen, wÃ¤hle die Sprache der Ergebnisse",
        langHint: "Deine Auswahl wird beim nÃ¤chsten Ã–ffnen gespeichert.",
        welcomeMsg: "Gib einen Begriff ein, ich zeige Wikipedia-Ergebnisse in deiner gewÃ¤hlten Sprache.",
        inputPlaceholder: "Begriff oder Satz eingeben",
        searchBtn: "Suchen",
        noTerm: "â— Bitte einen Suchbegriff eingeben",
        searching: "Suche lÃ¤uft...",
        results: "ğŸ“„ Ergebnisse (Titel anklicken fÃ¼r Zusammenfassung):",
        fetching: "ğŸ”„ Zusammenfassung wird geladen...",
        noResults: (t)=>`Keine Ergebnisse fÃ¼r: "${t}"`,
        searchErr: "âŒ Suchfehler. Bitte spÃ¤ter erneut versuchen.",
        fetchErr: "âŒ Fehler beim Laden. Bitte spÃ¤ter erneut versuchen.",
        copyBtn: "Ergebnis kopieren",
        copied: "âœ… Kopiert!",
        copyFail: "âŒ Kopieren fehlgeschlagen!",
        signature: "Von Zakaria KeFo",
        currentLang: (code)=>({ar:"Arabisch",en:"Englisch",de:"Deutsch"}[code]||code)
      }
    };

    function t(key, ...args){
      const v = uiText[uiLang][key];
      return typeof v === 'function' ? v(...args) : v;
    }

    function applyUIText(){
      langPrompt.textContent = t('langPrompt');
      document.getElementById('langHint').textContent = t('langHint');
      userInput.placeholder = t('inputPlaceholder');
      sendBtn.textContent = t('searchBtn');
      currentLangLabel.textContent = t('currentLang', wikiLang);

      // ØªØ­Ø¯ÙŠØ« ØªØ³Ù…ÙŠØ© Ø§Ù„ÙˆØ¶Ø¹ Ø¨Ø­Ø³Ø¨ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù‡Ù†Ø§)
      themeLabel.textContent = document.body.classList.contains('theme-light') ? 'Ù†Ù‡Ø§Ø±ÙŠ' : 'Ù„ÙŠÙ„ÙŠ';
    }

    /* =========================
       [6] Language Modal Open/Close + Save
       ========================= */

    function openLangModal(){ langModal.classList.add('open'); }
    function closeLangModal(){ langModal.classList.remove('open'); }

    function setWikiLang(langCode){
      wikiLang = langCode;
      localStorage.setItem(STORAGE_LANG, langCode);

      // Ø§ØªØ¬Ø§Ù‡ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø­Ø³Ø¨ Ù„ØºØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
      conversationContainer.style.direction = (wikiLang === 'ar') ? 'rtl' : 'ltr';

      applyUIText();
    }

    // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„ØºØ§Øª Ø¯Ø§Ø®Ù„ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
    document.querySelectorAll('.lang-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const lang = btn.getAttribute('data-lang');
        setWikiLang(lang);
        closeLangModal();
        showCopyNotification(t('copied'));
        keepLastLineVisible();
      });
    });

    // Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    changeLangBtn.addEventListener('click', ()=>{
      closeSettings();
      openLangModal();
    });

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„ØºØ©: Ø¥Ù† Ù„Ù… ØªÙƒÙ† Ù…Ø­ÙÙˆØ¸Ø©ØŒ Ù†ÙØªØ­ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©
    (function initLang(){
      const saved = localStorage.getItem(STORAGE_LANG);
      if (saved) {
        setWikiLang(saved);
      } else {
        openLangModal();
        applyUIText();
      }
    })();

    // ØªØ·Ø¨ÙŠÙ‚ Ù†ØµÙˆØµ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    applyUIText();

    /* =========================
       [7] Wikipedia API Helpers
       ========================= */

    function wikiBase(){
      return `https://${wikiLang}.wikipedia.org/w/api.php`;
    }

    /* =========================
       [8] Conversation Helpers
       ========================= */

    function addMessageToConversation(message, isUser = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message-bubble ${isUser ? 'user-bubble' : ''}`;
      messageDiv.textContent = message;

      // Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø±Ø³Ø§Ø© Ø­ØªÙ‰ ØªØ¨Ù‚Ù‰ Ø§Ù„Ù…Ø±Ø³Ø§Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¢Ø®Ø± Ø¹Ù†ØµØ±
      conversationContainer.insertBefore(messageDiv, bottomAnchor);

      // Ø£Ø¨Ù‚Ù Ø¢Ø®Ø± Ø³Ø·Ø± Ø¸Ø§Ù‡Ø±
      keepLastLineVisible();
    }

    function showCopyNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => { notification.remove(); }, 500);
      }, 1800);
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text)
        .then(() => { showCopyNotification(t('copied')); })
        .catch(() => { showCopyNotification(t('copyFail')); });
    }

    /* =========================
       [9] Search Wikipedia
       ========================= */

    async function searchWikipedia() {
      const searchTerm = userInput.value.trim();
      if (!searchTerm) {
        showCopyNotification(t('noTerm'));
        return;
      }

      // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø£ÙˆÙ„ Ù…Ø±Ø© ÙÙ‚Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
      if (!isMusicPlayed) {
        const audio = document.getElementById('background-music');
        audio.play().catch(() => {});
        isMusicPlayed = true;
      }

      addMessageToConversation(searchTerm, true);
      addMessageToConversation(t('searching'), false);

      const apiUrl = `${wikiBase()}?action=query&format=json&list=search&srsearch=${encodeURIComponent(searchTerm)}&origin=*`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        const results = (data.query && data.query.search) ? data.query.search : [];
        displaySearchResults(results, searchTerm);
      } catch (error) {
        console.error("Search error:", error);
        addMessageToConversation(t('searchErr'), false);
      } finally {
        userInput.value = '';
        userInput.focus();
      }
    }

    function displaySearchResults(results, searchTerm) {
      if (!results || results.length === 0) {
        addMessageToConversation(t('noResults', searchTerm), false);
        return;
      }

      addMessageToConversation(t('results'), false);

      results.slice(0, 10).forEach((result, index) => {
        const resultDiv = document.createElement('div');
        resultDiv.className = 'message-bubble';
        resultDiv.textContent = `${index + 1}. ${result.title}`;
        resultDiv.style.cursor = 'pointer';
        resultDiv.title = 'Click to fetch summary';
        resultDiv.onclick = () => fetchFullArticle(result.title);

        // Ø¥Ø¯Ø®Ø§Ù„Ù‡ Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø±Ø³Ø§Ø© Ø­ØªÙ‰ ØªØ¨Ù‚Ù‰ Ø§Ù„Ù…Ø±Ø³Ø§Ø© Ø¢Ø®Ø± Ø¹Ù†ØµØ±
        conversationContainer.insertBefore(resultDiv, bottomAnchor);
      });

      keepLastLineVisible();
    }

    /* =========================
       [10] Fetch Article Summary + Typing Effect
       ========================= */

    async function fetchFullArticle(title) {
      addMessageToConversation(t('fetching'), false);

      const apiUrl = `${wikiBase()}?action=query&format=json&prop=extracts&exintro&explaintext&titles=${encodeURIComponent(title)}&origin=*`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        const page = Object.values(data.query.pages)[0];
        const extract = page.extract || "No summary found.";

        // Ø¥Ù†Ø´Ø§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù‚Ø§Ù„
        const articleContainer = document.createElement('div');
        articleContainer.className = 'article-container';

        // Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠØ©
        const typingEffectDiv = document.createElement('div');
        typingEffectDiv.className = 'typing-effect';
        articleContainer.appendChild(typingEffectDiv);

        // Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø±Ø³Ø§Ø©
        conversationContainer.insertBefore(articleContainer, bottomAnchor);
        keepLastLineVisible();

        // ÙƒØªØ§Ø¨Ø© Ø­Ø±Ù-Ø¨Ø­Ø±Ù Ù…Ø¹ ØªØªØ¨Ø¹ Ø¢Ø®Ø± Ø³Ø·Ø± Ø¯Ø§Ø¦Ù…Ø§Ù‹
        let i = 0;
        const speed = 10; // Ø³Ø±Ø¹Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© (ÙƒÙ„Ù…Ø§ Ù‚Ù„ Ø§Ù„Ø±Ù‚Ù… Ø²Ø§Ø¯Øª Ø§Ù„Ø³Ø±Ø¹Ø©)

        function typeWriter() {
          if (i < extract.length) {
            typingEffectDiv.textContent += extract.charAt(i);
            i++;

            // Ù‡Ø°Ù‡ Ø§Ù„Ø³Ø·Ø± Ù‡Ùˆ Ø§Ù„Ù…Ù‡Ù…: ÙŠØ¨Ù‚ÙŠ Ø¢Ø®Ø± Ø­Ø±Ù Ø¸Ø§Ù‡Ø±
            keepLastLineVisible();

            setTimeout(typeWriter, speed);
          } else {
            // Ø§Ù„ØªÙˆÙ‚ÙŠØ¹
            const signature = document.createElement('div');
            signature.className = 'signature';
            signature.textContent = t('signature');
            articleContainer.appendChild(signature);

            // Ø²Ø± Ø§Ù„Ù†Ø³Ø®
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn';
            copyBtn.textContent = t('copyBtn');
            copyBtn.onclick = () => copyToClipboard(extract + "\n" + t('signature'));
            articleContainer.appendChild(copyBtn);

            keepLastLineVisible();
          }
        }

        typeWriter();

      } catch (error) {
        console.error("Fetch error:", error);
        addMessageToConversation(t('fetchErr'), false);
      }
    }

    /* =========================
       [11] Events: Click + Enter
       ========================= */

    sendBtn.addEventListener('click', searchWikipedia);
    userInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') searchWikipedia();
    });

    /* =========================
       [12] Start Message
       ========================= */

    addMessageToConversation(t('welcomeMsg'), false);

    /* =========================
       [13] Anti-Copy (Optional)
       ========================= */

    document.addEventListener("contextmenu", e => e.preventDefault());
    document.addEventListener("selectstart", e => e.preventDefault());
    document.addEventListener("touchstart", e => {
      if (e.touches.length > 1) e.preventDefault();
    }, { passive: false });

  </script>
</body>
</html>
